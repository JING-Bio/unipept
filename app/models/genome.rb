# == Schema Information
#
# Table name: genomes
#
#  id            :integer(4)      not null, primary key
#  name          :string(120)     not null
#  bioproject_id :string(15)      not null
#  refseq_id     :string(15)      not null
#  status        :string(45)      not null
#  species_id    :integer(3)
#  genus_id      :integer(3)
#

class Genome < ActiveRecord::Base
  attr_accessible nil
  
  def self.get_genome_species()
    # select taxons.name, taxons.id from (select lineages.species, count(*) as aantal from (select distinct uniprot_entries.taxon_id from genomes left join refseq_cross_references on genomes.refseq_id = refseq_cross_references.sequence_id left join uniprot_entries on refseq_cross_references.uniprot_entry_id = uniprot_entries.id) temp left join lineages on temp.taxon_id = lineages.taxon_id group by lineages.species having aantal > 1) temp2 left join taxons on temp2.species = taxons.id order by taxons.name;
    r = [["Acetobacterium woodii",33952],["Acidithiobacillus ferrooxidans",920],["Acinetobacter baumannii",470],["Actinobacillus pleuropneumoniae",715],["Aeromonas salmonicida",645],["Aggregatibacter actinomycetemcomitans",714],["Agrobacterium tumefaciens",358],["Alicycliphilus denitrificans",179636],["Alicyclobacillus acidocaldarius",405212],["Aliivibrio fischeri",668],["Allochromatium vinosum",1049],["Amycolatopsis mediterranei",33910],["Anabaena variabilis",1172],["Anaplasma marginale",770],["Archaeoglobus profundus",84156],["Arcobacter nitrofigilis",28199],["Arthrobacter phenanthrenivorans",361575],["Azorhizobium caulinodans",7],["Azotobacter vinelandii",354],["Bacillus amyloliquefaciens",1390],["Bacillus anthracis",1392],["Bacillus cereus",1396],["Bacillus megaterium",1404],["Bacillus pseudofirmus",79885],["Bacillus subtilis",1423],["Bacillus thuringiensis",1428],["Bacteroides fragilis",817],["Bartonella clarridgeiae",56426],["Bartonella grahamii",33045],["Bifidobacterium animalis",28025],["Bifidobacterium bifidum",1681],["Bifidobacterium longum",216816],["Bordetella avium",521],["Bordetella bronchiseptica",518],["Bordetella parapertussis",519],["Bordetella pertussis",520],["Borrelia burgdorferi",139],["Borrelia hermsii",140],["Brachyspira hyodysenteriae",159],["Bradyrhizobium japonicum",375],["Brucella abortus",235],["Brucella canis",36855],["Brucella melitensis",29459],["Brucella suis",29461],["Buchnera aphidicola",9],["Burkholderia cenocepacia",95486],["Burkholderia glumae",337],["Burkholderia mallei",13373],["Burkholderia multivorans",87883],["Burkholderia phytofirmans",261302],["Burkholderia pseudomallei",28450],["Burkholderia rhizoxinica",412963],["Burkholderia thailandensis",57975],["Burkholderia xenovorans",36873],["Caldicellulosiruptor saccharolyticus",44001],["Campylobacter jejuni",197],["Candidatus Phytoplasma mali",37692],["Candidatus Sulcia muelleri",336810],["Candidatus Tremblaya princeps",189385],["Caulobacter vibrioides",155892],["Cellulomonas fimi",1708],["Cellulosilyticum lentocellum",29360],["Chlamydia pneumoniae",83558],["Chlamydia psittaci",83554],["Chlamydia trachomatis",813],["Chlorobium phaeobacteroides",1096],["Citrobacter rodentium",67825],["Clavibacter michiganensis",28447],["Clostridium acetobutylicum",1488],["Clostridium botulinum",1491],["Clostridium cellulolyticum",1521],["Clostridium cellulovorans",1493],["Clostridium kluyveri",1534],["Clostridium perfringens",1502],["Clostridium thermocellum",1515],["Collimonas fungivorans",158899],["Corynebacterium diphtheriae",1717],["Corynebacterium glutamicum",1718],["Corynebacterium pseudotuberculosis",1719],["Corynebacterium resistens",258224],["Corynebacterium urealyticum",43771],["Coxiella burnetii",777],["Cupriavidus necator",106590],["Dehalococcoides mccartyi",61435],["Deinococcus proteolyticus",55148],["Deinococcus radiodurans",1299],["Desulfovibrio desulfuricans",876],["Desulfovibrio vulgaris",881],["Dickeya dadantii",204038],["Ehrlichia ruminantium",779],["Enterobacter cloacae",550],["Enterococcus faecalis",1351],["Erwinia amylovora",552],["Erwinia pyrifoliae",79967],["Escherichia coli",562],["Escherichia fergusonii",564],["Fibrobacter succinogenes",833],["Finegoldia magna",1260],["Flavobacterium johnsoniae",986],["Flavobacterium psychrophilum",96345],["Francisella novicida",264],["Francisella tularensis",263],["Gluconacetobacter diazotrophicus",33996],["Haemophilus influenzae",727],["Halalkalicoccus jeotgali",413810],["Haloferax volcanii",2246],["Halogeometricum borinquense",60847],["Halomicrobium mukohataei",57705],["Halomonas elongata",2746],["Halorubrum lacusprofundi",2247],["Halothiobacillus neapolitanus",927],["Helicobacter felis",214],["Helicobacter pylori",210],["Herbaspirillum seropedicae",964],["Histophilus somni",731],["Klebsiella oxytoca",571],["Klebsiella pneumoniae",573],["Lactobacillus acidophilus",1579],["Lactobacillus casei",1582],["Lactobacillus crispatus",47770],["Lactobacillus delbrueckii",1584],["Lactobacillus fermentum",1613],["Lactobacillus helveticus",1587],["Lactobacillus johnsonii",33959],["Lactobacillus plantarum",1590],["Lactobacillus reuteri",1598],["Lactobacillus rhamnosus",47715],["Lactobacillus sakei",1599],["Lactococcus lactis",1358],["Legionella pneumophila",446],["Leptospira biflexa",172],["Leuconostoc mesenteroides",1245],["Listeria monocytogenes",1639],["Megasphaera elsdenii",907],["Melissococcus plutonius",33970],["Methanococcus maripaludis",39152],["Methanosarcina mazei",2209],["Methanosphaera stadtmanae",2317],["Methanothermus fervidus",2180],["Methylobacterium chloromethanicum",82543],["Methylobacterium extorquens",408],["Methylobacterium nodulans",114616],["Methylocella silvestris",199596],["Methylococcus capsulatus",414],["Methylomicrobium alcaliphilum",271065],["Mycobacterium bovis",1765],["Mycobacterium leprae",1769],["Mycobacterium smegmatis",1772],["Mycobacterium tuberculosis",1773],["Mycoplasma agalactiae",2110],["Mycoplasma capricolum",2095],["Mycoplasma conjunctivae",45361],["Mycoplasma fermentans",2115],["Mycoplasma haemofelis",29501],["Mycoplasma hominis",2098],["Mycoplasma hyopneumoniae",2099],["Mycoplasma leachii",2105],["Mycoplasma mycoides",2102],["Mycoplasma pneumoniae",2104],["Mycoplasma putrefaciens",2123],["Mycoplasma suis",57372],["Myxococcus xanthus",34],["Neisseria gonorrhoeae",485],["Neisseria meningitidis",487],["Nitrosococcus oceani",1229],["Nitrosospira multiformis",1231],["Ochrobactrum anthropi",529],["Orientia tsutsugamushi",784],["Paenibacillus mucilaginosus",61624],["Paenibacillus polymyxa",1406],["Parabacteroides distasonis",823],["Paracoccus denitrificans",266],["Pasteurella multocida",747],["Pectobacterium atrosepticum",29471],["Pelobacter carbinolicus",19],["Planctomyces limnophilus",120],["Porphyromonas asaccharolytica",28123],["Porphyromonas gingivalis",837],["Prochlorococcus marinus",1219],["Propionibacterium acnes",1747],["Proteus mirabilis",584],["Pseudoalteromonas haloplanktis",228],["Pseudomonas aeruginosa",287],["Pseudomonas fluorescens",294],["Pseudomonas putida",303],["Pseudomonas stutzeri",316],["Pyrobaculum aerophilum",13773],["Pyrobaculum calidifontis",181486],["Pyrobaculum islandicum",2277],["Pyrobaculum oguniense",99007],["Pyrococcus furiosus",2261],["Rahnella aquatilis",34038],["Ralstonia pickettii",329],["Ralstonia solanacearum",305],["Rhizobium etli",29449],["Rhizobium leguminosarum",384],["Rhodobacter capsulatus",1061],["Rhodobacter sphaeroides",1063],["Rhodopseudomonas palustris",1076],["Rhodospirillum rubrum",1085],["Rhodothermus marinus",29549],["Rickettsia canadensis",788],["Rickettsia massiliae",35791],["Rickettsia prowazekii",782],["Rickettsia rickettsii",783],["Rickettsia typhi",785],["Roseobacter denitrificans",2434],["Ruminococcus albus",1264],["Saccharopolyspora erythraea",1836],["Salinibacter ruber",146919],["Salmonella enterica",28901],["Shewanella baltica",62322],["Shewanella frigidimarina",56812],["Shewanella violacea",60217],["Shigella flexneri",623],["Shigella sonnei",624],["Sinorhizobium fredii",380],["Sinorhizobium medicae",110321],["Sinorhizobium meliloti",382],["Staphylococcus aureus",1280],["Staphylococcus epidermidis",1282],["Staphylococcus saprophyticus",29385],["Starkeya novella",921],["Stenotrophomonas maltophilia",40324],["Streptococcus agalactiae",1311],["Streptococcus equi",1336],["Streptococcus mitis",28037],["Streptococcus mutans",1309],["Streptococcus pasteurianus",197614],["Streptococcus pneumoniae",1313],["Streptococcus pyogenes",1314],["Streptococcus suis",1307],["Streptococcus thermophilus",1308],["Streptomyces cattleya",29303],["Streptomyces coelicolor",1902],["Streptomyces griseus",1911],["Sulfobacillus acidophilus",53633],["Sulfolobus islandicus",43080],["Sulfolobus solfataricus",2287],["Synechococcus elongatus",32046],["Thermobifida fusca",2021],["Thermococcus onnurineus",342948],["Thermotoga maritima",2336],["Thermotoga neapolitana",2337],["Thermus thermophilus",274],["Treponema pallidum",160],["Tropheryma whipplei",2039],["Ureaplasma parvum",134821],["Ureaplasma urealyticum",2130],["Variovorax paradoxus",34073],["Vibrio anguillarum",55601],["Vibrio cholerae",666],["Vibrio vulnificus",672],["Wigglesworthia glossinidia",51229],["Xanthomonas campestris",339],["Xanthomonas oryzae",347],["Xylella fastidiosa",2371],["Yersinia enterocolitica",630],["Yersinia pestis",632],["Yersinia pseudotuberculosis",633],["Zymomonas mobilis",542],["[Clostridium] difficile",1496],["[Clostridium] sticklandii",1511]]
    return r
  end

  # returns a set of genome objects for a given species_id
  def self.get_by_species_id(species_id)
    Genome.where("species_id = ?", species_id)
  end

  # fills in the species_id and genus_id columns
  def self.precompute_species_and_genera
    Genome.all.each do |genome|
      lineage = Lineage.find_by_sql("SELECT DISTINCT lineages.* 
            FROM lineages 
            LEFT JOIN uniprot_entries ON lineages.taxon_id = uniprot_entries.taxon_id 
            LEFT JOIN refseq_cross_references ON uniprot_entry_id = uniprot_entries.id
            WHERE sequence_id = '#{genome.refseq_id}'").first
      unless lineage.nil?
        genome.species_id = lineage.species
        genome.genus_id = lineage.genus
        genome.save
      end
    end
  end
end
