<h1>Peptidome Analysis</h1>
<p>This application lets you find unique peptides for a species of your choice, based on the data of the completed refseq genomes. These peptides can be downloaded and used for targeted proteomics experiments.</p>
<p>When you add a genome to the set (e.g., by dragging one from the tree to the graph or table), the union and intersection of the peptides of that genome and the ones already added are calculated. The size of the union (pan peptidome) is represented by the blue dots and the size of the intersection (core peptidome) is represented by the orange dots. Additionally, a more restrictive version of the core peptidome is calculated (green dots) by only including peptides that are unique for the selected genomes. These unique peptides have the same Lowest Common Ancestor (LCA) as the LCA of the selected genomes.</p>
<p>You can easily reorder the genomes by dragging them to the desired position or by using one of the automatic sort options. By clicking on one of the data points on the graph, you can download a list of peptides.</p>

<div id="buttons-pancore"></div>

<ul id="tabs" class="nav nav-tabs">
  <li class="<%= @tab == "peptidefinder" ? "active" : ""%>"><a href="#pancore_graph_wrapper" data-toggle="tab">Unique Peptide Finder</a></li>
  <li class="<%= @tab == "peptidomeclustering" ? "active" : ""%>"><a href="#sim_matrix_wrapper" data-toggle="tab">Peptidome Clustering</a></li>
</ul>

<div class="tab-help" id="tab-help">
  <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur sit amet enim neque. Phasellus in molestie mi. Suspendisse ac orci tellus. Fusce fermentum bibendum leo, porttitor tempor libero feugiat a. Suspendisse justo quam, egestas sed urna quis, tempus accumsan augue. Suspendisse in tincidunt nisi, ut pharetra massa. Nulla quis nisi porta, hendrerit sem at, pellentesque ligula. Suspendisse nec mollis velit, sit amet consectetur risus. Aenean congue non justo id molestie. Etiam gravida purus eros, sodales pretium quam ultrices quis.</p>
  <p>Nullam massa arcu, viverra ac ante ac, placerat pharetra massa. Maecenas tincidunt fringilla feugiat. Fusce lacus quam, sollicitudin sit amet sollicitudin vitae, congue id dolor. Suspendisse erat odio, posuere sit amet mi at, accumsan mattis leo. Sed gravida felis accumsan fringilla gravida. Vivamus at sapien quis enim varius imperdiet bibendum ut tellus. Nam sit amet quam nisi. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Aliquam ut sem dolor.</p>
</div>

<div class="tab-content">
  <div class="tab-pane fade <%= @tab == "peptidefinder" ? "in active" : ""%>" id="pancore_graph_wrapper">
    <div id="pancore_graph">
      <div id="popovers"></div>
    </div>
  </div>
  <div class="tab-pane fade <%= @tab == "peptidomeclustering" ? "in active" : ""%>" id="sim_matrix_wrapper">
    <div id="sim_matrix"></div>
  </div>
</div>


<div class="split">
  <div class="split-left">
    <p class="intro">
      To analyze some genomes, select a species from the list and click the load button or drag a node from the tree to the table on the right.
    </p>
    <%= form_tag(:pancore_analyze, :method => "get", :class => "form-inline") do %>
        <div class="form-group"><%= select_tag(:species_id, options_for_select(@species, params[:species_id]), :class => "form-control") %></div>
        <div class="form-group"><%= button_tag(raw("Add species <span class='glyphicon glyphicon-chevron-right'></span>"), :type => "button", :class => "btn btn-primary", :id => "add_species_peptidome", :"data-loading-text" => "Loading...") %></div>
    <% end %>
    <div id="treeView" class="treeView pancore">
      <div class="input-group" id="treeSearchDiv">
      <%= search_field_tag(:treeSearch, "", :placeholder => "type to filter the tree by name or bioproject id", :class => "form-control") %><span class="input-group-addon"><span class="glyphicon glyphicon-search"></span></span>
      </div>
    </div>
  </div>

  <div class="split-right">
    <span id="table-message"><span class="glyphicon glyphicon-chevron-left"></span> Select a species to analyze and click the load button.</span>
    <div id="genomes-table-div">
      <div style="overflow: hidden; height: 0px; width: 0px;">&nbsp;</div>
      <table class="table table-condensed" id="genomes_table">
        <thead>
          <tr>
            <th class="handle">
              <div class="btn-group" id="autosort">
                <a class="btn btn-xs btn-primary dropdown-toggle" data-toggle="dropdown" id="autosort-button">
                  <span class="glyphicon glyphicon-random"></span>
                </a>
                <ul class="dropdown-menu">
                  <li><a data-type="name" data-toggle="tooltip" title="Sorts the genomes alphabetically from A-Z." href="#">Sort by name</a></li>
                  <li><a data-type="size" data-toggle="tooltip" title="Sorts the genomes by the number of peptides from high to low." href="#">Sort by genome size</a></li>
                  <li><a data-type="minpan" data-toggle="tooltip" title="Heuristically minimizes the pan line. Starts from the current first node." href="#">Minimize the pan</a></li>
                  <li><a data-type="maxcore" data-toggle="tooltip" title="Heuristically maximizes the core line. Starts from the current first node." href="#">Maximize the core</a></li>
                  <li><a data-type="optimal" data-toggle="tooltip" title="Heuristically minimizes the distance between the pan and core line. Starts from the current first node." href="#">Optimize pan and core</a></li>
                  <li><a data-type="clustered" data-toggle="tooltip" title="Cluster the matrix and use the order calculated." href="#">Cluster matrix</a></li>
                </ul>
              </div>
            </th>
            <th class="name">Genome</th>
            <th class="status"></th>
            <th class="action"><a id="remove-all" class="btn btn-xs btn-danger" title="remove all genomes"><span class="glyphicon glyphicon-trash"></span></a></th>
          </tr>
          <tr id="reorder-header" class="hidden warning">
              <td colspan="4" align="center">
                  The order of the genomes in this table currently doesn't correspond with the order in the similarity matrix<br>
                  <a id='use-cluster-order' class="btn btn-primary btn-xs" title="reorder the table to correspond with the clustered order"><span class="glyphicon glyphicon-random"></span> Use clustered order</a>
                  <a id='decluster-matrix' class="btn btn-default btn-xs" title="decluster the matrix and keep using the order of the table">Undo clustering</a>
              </td>
          <tr>
        </thead>
        <tbody>
        </tbody>
        <tfoot>
          <tr><th colspan=4><span class="glyphicon glyphicon-plus"></span> Drop genomes here</th></tr>
        </tfoot>
      </table>
    </div>
    <div class="visualClear"></div>
  </div>
</div>

<script type="text/javascript">
  $(function () {
    if (typeof(Worker)!=="undefined") {
        constructPancore({
            data : <%= raw(@genomes) %>,
            taxa : <%= raw(@taxa) %>
        });
    } else {
      error(null, "Sorry, this page uses Web Workers, an advanced JavaScript technology that's not supported by your browser. Try using an up to date version of Google Chrome, Firefox or Internet Explorer 10.")
    }
  });
</script>

<%= render 'shared/save_image_modal' %>
